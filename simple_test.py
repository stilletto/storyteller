#!/usr/bin/env python3
"""
–£–ø—Ä–æ—â—ë–Ω–Ω—ã–π —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã Storyteller –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
"""

import os
import sys
from datetime import datetime

# –≠–º—É–ª—è—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ —Å—Ç–∏–ª–µ –†–æ—Ç—Ñ—É—Å—Å–∞
SAMPLE_FRAME_NARRATIVE = """
–ù–∞—Å—Ç—É–ø–∏–ª–∞ –Ω–æ—á—å. –¢—Ä–∞–∫—Ç–∏—Ä ¬´–ü—É—Ç–µ–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å¬ª –ø–æ–≥—Ä—É–∑–∏–ª—Å—è –≤ —Ç–∏—à–∏–Ω—É, –∏ —Å–∫–ª–∞–¥—ã–≤–∞–ª–∞—Å—å —ç—Ç–∞ —Ç–∏—à–∏–Ω–∞ –∏–∑ —Ç—Ä—ë—Ö —á–∞—Å—Ç–µ–π.

–ü–µ—Ä–≤–∞—è —á–∞—Å—Ç—å –±—ã–ª–∞ –æ—á–µ–≤–∏–¥–Ω–æ–π ‚Äî –ø—É—Å—Ç–æ—Ç–∞. –í —Ç—Ä–∞–∫—Ç–∏—Ä–µ –Ω–µ –±—ã–ª–æ –Ω–∏ –µ–¥–∏–Ω–æ–≥–æ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è, —á—Ç–æ —Å–∞–º–æ –ø–æ —Å–µ–±–µ –∫–∞–∑–∞–ª–æ—Å—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º, —Å–ª–æ–≤–Ω–æ –≤ –º–∏—Ä–µ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å. –û–±—ã—á–Ω–æ –∫ —ç—Ç–æ–º—É —á–∞—Å—É —Ö–æ—Ç—è –±—ã –ø–∞—Ä–∞ –ø—É—Ç–Ω–∏–∫–æ–≤ –∏—Å–∫–∞–ª–∞ –ø—Ä–∏—é—Ç –æ—Ç –Ω–æ—á–Ω–æ–π –¥–æ—Ä–æ–≥–∏, –Ω–æ —Å–µ–≥–æ–¥–Ω—è –¥–∞–∂–µ –≤–µ—Ç–µ—Ä –∑–∞–±—ã–ª –ø–æ—Å—Ç—É—á–∞—Ç—å –≤ –¥–≤–µ—Ä—å.

–í—Ç–æ—Ä–∞—è —Ç–∏—à–∏–Ω–∞ —Ç–∞–∏–ª–∞—Å—å –≤ —Å–∞–º–∏—Ö —Å—Ç–µ–Ω–∞—Ö —Ç—Ä–∞–∫—Ç–∏—Ä–∞. –û–Ω–∞ —Å–æ—á–∏–ª–∞—Å—å –∏–∑ –ø–æ—Ç–µ–º–Ω–µ–≤—à–µ–≥–æ –¥–µ—Ä–µ–≤–∞, –∫–∞–ø–∞–ª–∞ —Å –ø–æ–ª–æ–∫, –≥–¥–µ –ø—ã–ª–∏–ª–∏—Å—å –±—É—Ç—ã–ª–∫–∏ —Å –≤–∏–Ω–æ–º, –∫–æ—Ç–æ—Ä–æ–µ –Ω–∏–∫—Ç–æ –Ω–µ –∑–∞–∫–∞–∑—ã–≤–∞–ª –º–µ—Å—è—Ü–∞–º–∏. –≠—Ç–æ –±—ã–ª–∞ —Ç–∏—à–∏–Ω–∞ –æ–∂–∏–¥–∞–Ω–∏—è ‚Äî —Ç–µ—Ä–ø–µ–ª–∏–≤–∞—è, –∫–∞–∫ –ø–∞—É–∫ –≤ —Å–≤–æ–µ–π –ø–∞—É—Ç–∏–Ω–µ.

–¢—Ä–µ—Ç—å—è —Ç–∏—à–∏–Ω–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞–ª–∞ —Ä—ã–∂–µ–≤–æ–ª–æ—Å–æ–º—É –º—É–∂—á–∏–Ω–µ –∑–∞ –±–∞—Ä–Ω–æ–π —Å—Ç–æ–π–∫–æ–π. –ö–æ—É—Ç ‚Äî —Ç–∞–∫ –µ–≥–æ –∑–Ω–∞–ª–∏ –Ω–µ–º–Ω–æ–≥–∏–µ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ ‚Äî –ø—Ä–æ—Ç–∏—Ä–∞–ª —É–∂–µ —á–∏—Å—Ç—ã–π —Å—Ç–∞–∫–∞–Ω —Å –º–µ—Ç–æ–¥–∏—á–Ω–æ—Å—Ç—å—é —á–µ–ª–æ–≤–µ–∫–∞, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏–µ —Å—Ç–∞–ª–æ —Å–ø–æ—Å–æ–±–æ–º –Ω–µ –¥—É–º–∞—Ç—å. –ï–≥–æ –∑–µ–ª—ë–Ω—ã–µ –≥–ª–∞–∑–∞, –∫–æ–≥–¥–∞-—Ç–æ —è—Ä–∫–∏–µ, –∫–∞–∫ –≤–µ—Å–µ–Ω–Ω—è—è –ª–∏—Å—Ç–≤–∞, —Ç–µ–ø–µ—Ä—å –Ω–∞–ø–æ–º–∏–Ω–∞–ª–∏ —Ç—É—Å–∫–ª–æ–µ —Å—Ç–µ–∫–ª–æ —Å—Ç–∞—Ä—ã—Ö –±—É—Ç—ã–ª–æ–∫. –í –Ω–∏—Ö –∂–∏–ª–∞ —Ç–∏—à–∏–Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ—Å—Ç–∞–ª –∂–¥–∞—Ç—å.

–ë–∞—Å—Ç —Å–∏–¥–µ–ª —É –æ–∫–Ω–∞, –∏–∑–æ–±—Ä–∞–∂–∞—è, —á—Ç–æ —á–∏—Ç–∞–µ—Ç –∫–Ω–∏–≥—É, –Ω–æ –µ–≥–æ –≤–∑–≥–ª—è–¥ —Ç–æ –∏ –¥–µ–ª–æ —Å–∫–æ–ª—å–∑–∏–ª –∫ —É—á–∏—Ç–µ–ª—é. –ß—Ç–æ-—Ç–æ –±—ã–ª–æ –Ω–µ —Ç–∞–∫ —ç—Ç–æ–π –Ω–æ—á—å—é. –ß—Ç–æ-—Ç–æ –≤–∏—Å–µ–ª–æ –≤ –≤–æ–∑–¥—É—Ö–µ, –∫–∞–∫ –∑–∞–ø–∞—Ö –≥—Ä–æ–∑—ã –∑–∞ —á–∞—Å –¥–æ –ø–µ—Ä–≤–æ–π –º–æ–ª–Ω–∏–∏.

‚Äî –†–µ—à–∏, ‚Äî –Ω–∞—á–∞–ª –æ–Ω –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ, ‚Äî —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å?

–ö–æ—É—Ç –Ω–µ –ø–æ–¥–Ω—è–ª –≥–ª–∞–∑ –æ—Ç —Å—Ç–∞–∫–∞–Ω–∞.

‚Äî –ß—Ç–æ –∏–º–µ–Ω–Ω–æ —è –¥–æ–ª–∂–µ–Ω —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å, –ë–∞—Å—Ç?

‚Äî –û–Ω–∏ –ø—Ä–∏–±–ª–∏–∂–∞—é—Ç—Å—è. –ö–æ–∂–µ—Ö–æ–¥—ã. –Ø —á—É—é –∏—Ö –¥–∞–∂–µ –æ—Ç—Å—é–¥–∞.
"""

SAMPLE_INNER_NARRATIVE = """
–Ø –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –≤–∞–º –æ —Ç–æ–º –¥–Ω–µ, –∫–æ–≥–¥–∞ –≤–ø–µ—Ä–≤—ã–µ —É–≤–∏–¥–µ–ª –∏—Å—Ç–∏–Ω–Ω–æ–µ –ª–∏—Ü–æ —Å—Ç—Ä–∞—Ö–∞. –ù–µ —Ç–æ–≥–æ –¥–µ—Ç—Å–∫–æ–≥–æ —Å—Ç—Ä–∞—Ö–∞ —Ç–µ–º–Ω–æ—Ç—ã –∏–ª–∏ –±–æ—è–∑–Ω–∏ –ø–æ—Ç–µ—Ä—è—Ç—å –ª—é–±–∏–º—É—é –∏–≥—Ä—É—à–∫—É. –ù–µ—Ç, —è –≥–æ–≤–æ—Ä—é –æ —Ç–æ–º –¥—Ä–µ–≤–Ω–µ–º, –ø–µ—Ä–≤–æ–±—ã—Ç–Ω–æ–º —É–∂–∞—Å–µ, –∫–æ—Ç–æ—Ä—ã–π –∂–∏–≤—ë—Ç –≤ —Å–∞–º—ã—Ö –≥–ª—É–±–∏–Ω–∞—Ö –Ω–∞—à–µ–π –∫—Ä–æ–≤–∏ ‚Äî –Ω–∞—Å–ª–µ–¥–∏–µ —Ç–µ—Ö –≤—Ä–µ–º—ë–Ω, –∫–æ–≥–¥–∞ –ª—é–¥–∏ –µ—â—ë –ø–æ–º–Ω–∏–ª–∏, —á—Ç–æ –∑–Ω–∞—á–∏—Ç –±—ã—Ç—å –¥–æ–±—ã—á–µ–π.

–ú–Ω–µ –±—ã–ª–æ –¥–µ–≤—è—Ç–Ω–∞–¥—Ü–∞—Ç—å, –∏ —è –¥—É–º–∞–ª, —á—Ç–æ –∑–Ω–∞—é –≤—Å—ë –æ –º–∏—Ä–µ. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –Ω–∞—É—á–∏–ª –º–µ–Ω—è —Å–∏–º–ø–∞—Ç–∏–∏, —è –º–æ–≥ —Å–≤—è–∑–∞—Ç—å –ø–ª–∞–º—è —Å–≤–µ—á–∏ —Å –±–∏–µ–Ω–∏–µ–º —Å–≤–æ–µ–≥–æ —Å–µ—Ä–¥—Ü–∞, –º–æ–≥ –∑–∞—Å—Ç–∞–≤–∏—Ç—å –∂–µ–ª–µ–∑–æ –ø–µ—Ç—å. –Ø –∑–Ω–∞–ª —Å–µ–º—å —Å–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Å—Ç–∞–≤—è—Ç –∂–µ–Ω—â–∏–Ω—É –ª—é–±–∏—Ç—å —Ç–µ–±—è, –∏ –æ–¥–Ω–æ, –∫–æ—Ç–æ—Ä–æ–µ –∑–∞—Å—Ç–∞–≤–∏—Ç –µ—ë —É–π—Ç–∏ –Ω–∞–≤—Å–µ–≥–¥–∞. –Ø –¥—É–º–∞–ª, —á—Ç–æ –∑–Ω–∞–Ω–∏–µ ‚Äî —ç—Ç–æ —Å–∏–ª–∞.

–ö–∞–∫ –∂–µ —è –æ—à–∏–±–∞–ª—Å—è.

–î–µ–Ω–Ω–∞ –Ω–∞—à–ª–∞ –º–µ–Ω—è –≤ —Ç–æ—Ç –¥–µ–Ω—å –≤ –ò–º—Ä–µ, –≤ –º–∞–ª–µ–Ω—å–∫–æ–π —Ç–∞–≤–µ—Ä–Ω–µ ¬´–°–µ—Ä–µ–±—Ä—è–Ω–∞—è –ª–∏—Ä–∞¬ª. –û–Ω–∞ –ø–æ—è–≤–∏–ª–∞—Å—å, –∫–∞–∫ –≤—Å–µ–≥–¥–∞ –ø–æ—è–≤–ª—è–ª–∞—Å—å –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏ ‚Äî –≤–Ω–µ–∑–∞–ø–Ω–æ, —Å–ª–æ–≤–Ω–æ –¥—É–Ω–æ–≤–µ–Ω–∏–µ –≤–µ—Ç—Ä–∞, –∫–æ—Ç–æ—Ä–æ–µ –≥–∞—Å–∏—Ç —Å–≤–µ—á—É, –∞ –ø–æ—Ç–æ–º –∏—Å—á–µ–∑–∞–µ—Ç, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ –¥—ã–º –∏ —Å–æ–∂–∞–ª–µ–Ω–∏–µ.

‚Äî –ö–≤–æ—É—Ç, ‚Äî —Å–∫–∞–∑–∞–ª–∞ –æ–Ω–∞, –∏ –≤ –µ—ë –≥–æ–ª–æ—Å–µ —è —É—Å–ª—ã—à–∞–ª —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ. –ù–µ —Å—Ç—Ä–∞—Ö ‚Äî –î–µ–Ω–Ω–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ —Å—Ç—Ä–∞—Ö–∞. –≠—Ç–æ –±—ã–ª–æ —á—Ç–æ-—Ç–æ –≥–ª—É–±–∂–µ. –ü—Ä–µ–¥—á—É–≤—Å—Ç–≤–∏–µ, –º–æ–∂–µ—Ç –±—ã—Ç—å. –ò–ª–∏ –∑–Ω–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏.

‚Äî –ú–Ω–µ –Ω—É–∂–Ω–∞ —Ç–≤–æ—è –ø–æ–º–æ—â—å, ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∏–ª–∞ –æ–Ω–∞, –∏ —ç—Ç–∏ —á–µ—Ç—ã—Ä–µ —Å–ª–æ–≤–∞ –∏–∑–º–µ–Ω–∏–ª–∏ –≤—Å—ë.

–í–∏–¥–∏—Ç–µ –ª–∏, –î–µ–Ω–Ω–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ—Å–∏–ª–∞ –æ –ø–æ–º–æ—â–∏. –û–Ω–∞ –±—ã–ª–∞ –∫–∞–∫ –∫–æ—à–∫–∞ ‚Äî –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è, —Å–≤–æ–µ–Ω—Ä–∞–≤–Ω–∞—è, –ø–æ—è–≤–ª—è–ª–∞—Å—å –∏ –∏—Å—á–µ–∑–∞–ª–∞ –ø–æ —Å–≤–æ–µ–º—É –∂–µ–ª–∞–Ω–∏—é. –ò –≤–æ—Ç –æ–Ω–∞ —Å—Ç–æ—è–ª–∞ –ø–µ—Ä–µ–¥–æ –º–Ω–æ–π, –∏ –≤ –µ—ë —Ç—ë–º–Ω—ã—Ö –≥–ª–∞–∑–∞—Ö —è –≤–∏–¥–µ–ª –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ —á–µ–≥–æ-—Ç–æ, —á–µ–≥–æ –Ω–µ –º–æ–≥ –Ω–∞–∑–≤–∞—Ç—å.
"""

SAMPLE_MAGIC_SCENE = """
–Ø –ø–æ–¥–Ω—è–ª —Ä—É–∫—É, –∏ –º–æ–π –∞–ª–∞—Ä ‚Äî –º–æ—è –Ω–µ–ø–æ–∫–æ–ª–µ–±–∏–º–∞—è –≤–µ—Ä–∞ ‚Äî —Ä–∞—Å–∫–æ–ª–æ–ª—Å—è –Ω–∞–¥–≤–æ–µ. –û–¥–Ω–∞ —á–∞—Å—Ç—å –∑–Ω–∞–ª–∞, —á—Ç–æ –º–æ–Ω–µ—Ç–∞ –≤ –º–æ–µ–π —Ä—É–∫–µ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –∫—É—Å–æ–∫ –º–µ–¥–∏. –î—Ä—É–≥–∞—è —á–∞—Å—Ç—å –∑–Ω–∞–ª–∞ —Å —Ç–∞–∫–æ–π –∂–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é, —á—Ç–æ —ç—Ç–∞ –º–æ–Ω–µ—Ç–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –∂–µ–ª–µ–∑–Ω—ã–º –≥–≤–æ–∑–¥—ë–º –≤ —Å—Ç–µ–Ω–µ —Ç–∞–≤–µ—Ä–Ω—ã.

–ü—Ä–∏–Ω—Ü–∏–ø —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è. –ú–µ–¥—å –∏ –∂–µ–ª–µ–∑–æ, –∫–æ–Ω–µ—á–Ω–æ, –Ω–µ –∏–¥–µ–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞ ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å, –¥–≤–µ–Ω–∞–¥—Ü–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –Ω–µ –±–æ–ª—å—à–µ. –ù–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ö–≤–∞—Ç–∏—Ç.

–Ø —Å–∂–∞–ª –º–æ–Ω–µ—Ç—É, —á—É–≤—Å—Ç–≤—É—è, –∫–∞–∫ —Ç–µ–ø–ª–æ —É—Ç–µ–∫–∞–µ—Ç –∏–∑ –º–æ–µ–≥–æ —Ç–µ–ª–∞. –ú–æ–∏ –ø–∞–ª—å—Ü—ã –Ω–∞—á–∞–ª–∏ –Ω–µ–º–µ—Ç—å ‚Äî –ø–µ—Ä–≤—ã–π –ø—Ä–∏–∑–Ω–∞–∫ —Ç–æ–≥–æ, —á—Ç–æ —è —á–µ—Ä–ø–∞—é –∏–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏. –°–≤—è–∑—å –Ω–∞—Ç—è–Ω—É–ª–∞—Å—å –º–µ–∂–¥—É –º–æ–Ω–µ—Ç–æ–π –∏ –≥–≤–æ–∑–¥—ë–º, –Ω–µ–≤–∏–¥–∏–º–∞—è, –Ω–æ —Ä–µ–∞–ª—å–Ω–∞—è, –∫–∞–∫ —Å—Ç—Ä—É–Ω–∞ –ª—é—Ç–Ω–∏.

‚Äî –°–º–æ—Ç—Ä–∏, ‚Äî —Å–∫–∞–∑–∞–ª —è –î–µ–Ω–Ω–µ, –∏ –ø–æ–≤–µ—Ä–Ω—É–ª –º–æ–Ω–µ—Ç—É.

–ì–≤–æ–∑–¥—å –≤ —Å—Ç–µ–Ω–µ –ø–æ–≤–µ—Ä–Ω—É–ª—Å—è –≤–º–µ—Å—Ç–µ —Å –Ω–µ–π.

–ï—ë –≥–ª–∞–∑–∞ —Ä–∞—Å—à–∏—Ä–∏–ª–∏—Å—å ‚Äî –Ω–µ –æ—Ç —É–¥–∏–≤–ª–µ–Ω–∏—è, –æ–Ω–∞ –≤–∏–¥–µ–ª–∞ —Å–∏–º–ø–∞—Ç–∏—é —Ä–∞–Ω—å—à–µ. –ù–µ—Ç, —ç—Ç–æ –±—ã–ª–æ —É–∑–Ω–∞–≤–∞–Ω–∏–µ. –°–ª–æ–≤–Ω–æ –æ–Ω–∞ —É–≤–∏–¥–µ–ª–∞ —á—Ç–æ-—Ç–æ –∑–Ω–∞–∫–æ–º–æ–µ –≤ —Ç–æ–º, –∫–∞–∫ —è –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞–ª —Å–≤—è–∑—è–º–∏ –º–∏—Ä–∞.

‚Äî –ö–∞–∫ —Ç—ã —É–¥–µ—Ä–∂–∏–≤–∞–µ—à—å –≤–µ—Ä—É? ‚Äî —Å–ø—Ä–æ—Å–∏–ª–∞ –æ–Ω–∞ —Ç–∏—Ö–æ. ‚Äî –ö–∞–∫ —Ç—ã –º–æ–∂–µ—à—å –≤–µ—Ä–∏—Ç—å –≤ –¥–≤–µ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–µ –≤–µ—â–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?

–Ø –ø–æ–∂–∞–ª –ø–ª–µ—á–∞–º–∏, —Å—Ç–∞—Ä–∞—è—Å—å –≤—ã–≥–ª—è–¥–µ—Ç—å –±–µ–∑–∑–∞–±–æ—Ç–Ω—ã–º, —Ö–æ—Ç—è —Ö–æ–ª–æ–¥ —É–∂–µ –¥–æ–±—Ä–∞–ª—Å—è –¥–æ –º–æ–∏—Ö —Ä—ë–±–µ—Ä.

‚Äî –ü—Ä–∞–∫—Ç–∏–∫–∞. –ò –Ω–µ–º–Ω–æ–≥–æ –±–µ–∑—É–º–∏—è.

–ù–æ –ø—Ä–∞–≤–¥–∞ –±—ã–ª–∞ —Å–ª–æ–∂–Ω–µ–µ. –ß—Ç–æ–±—ã –±—ã—Ç—å —Å–∏–º–ø–∞—Ç–∏—Å—Ç–æ–º, –Ω—É–∂–Ω–æ –Ω–∞—É—á–∏—Ç—å—Å—è –ª–≥–∞—Ç—å —Å–∞–º–æ–º—É —Å–µ–±–µ —Ç–∞–∫ —É–±–µ–¥–∏—Ç–µ–ª—å–Ω–æ, —á—Ç–æ –ª–æ–∂—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∞–≤–¥–æ–π. –ù—É–∂–Ω–æ —Ä–∞—Å–∫–æ–ª–æ—Ç—å —Å–≤–æ–π —Ä–∞–∑—É–º –∏ —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ—Å–∫–æ–ª–∫–∏ –≤–º–µ—Å—Ç–µ —Å–∏–ª–æ–π –≤–æ–ª–∏.

–ò–Ω–æ–≥–¥–∞ —è –¥—É–º–∞—é, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –≤ –∫–æ–Ω—Ü–µ –∫–æ–Ω—Ü–æ–≤ —Å–ª–æ–º–∞–ª–æ –º–µ–Ω—è. –ù–µ –ß–∞–Ω–¥—Ä–∏–∞–Ω–µ, –Ω–µ –ø–æ—Ç–µ—Ä—è –≤—Å–µ–≥–æ, —á—Ç–æ —è –ª—é–±–∏–ª. –ê –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–ª–æ—Å—Ç—å –æ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –ª–∂–∏ —Å–∞–º–æ–º—É —Å–µ–±–µ.
"""

def analyze_text_quality(text: str, text_type: str) -> dict:
    """–ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"""
    
    analysis = {
        "type": text_type,
        "word_count": len(text.split()),
        "style_markers": {},
        "consistency": {},
        "rating": {}
    }
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –º–∞—Ä–∫–µ—Ä–æ–≤
    if text_type == "frame":
        analysis["style_markers"]["silence_description"] = "—Ç–∏—à–∏–Ω–∞" in text.lower() and "—Ç—Ä—ë—Ö —á–∞—Å—Ç–µ–π" in text.lower()
        analysis["style_markers"]["third_person"] = text.count("–ö–æ—É—Ç") > text.count("—è")
        analysis["style_markers"]["present_tense"] = "–ø–æ–≥—Ä—É–∑–∏–ª—Å—è" in text or "—Å–∏–¥–µ–ª" in text
        analysis["style_markers"]["waystone_inn"] = "–ü—É—Ç–µ–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å" in text
    else:
        analysis["style_markers"]["first_person"] = text.count("—è") > 3
        analysis["style_markers"]["past_tense"] = "–±—ã–ª–æ" in text or "–¥—É–º–∞–ª" in text
        analysis["style_markers"]["storytelling_voice"] = "–¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å" in text or "–≤–∏–¥–∏—Ç–µ –ª–∏" in text
    
    # –û–±—â–∏–µ –º–∞—Ä–∫–µ—Ä—ã —Å—Ç–∏–ª—è –†–æ—Ç—Ñ—É—Å—Å–∞
    analysis["style_markers"]["similes"] = text.count("—Å–ª–æ–≤–Ω–æ") + text.count("–∫–∞–∫") + text.count("–±—É–¥—Ç–æ")
    analysis["style_markers"]["poetic_language"] = bool(analysis["style_markers"]["similes"] > 3)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
    if text_type == "frame":
        analysis["consistency"]["character_names"] = all(name in text for name in ["–ö–æ—É—Ç", "–ë–∞—Å—Ç"])
        analysis["consistency"]["setting"] = "—Ç—Ä–∞–∫—Ç–∏—Ä" in text.lower()
    else:
        analysis["consistency"]["character_voice"] = "–î–µ–Ω–Ω–∞" in text or "–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç" in text
        analysis["consistency"]["past_events"] = any(word in text for word in ["–ø–æ–º–Ω—é", "–±—ã–ª–æ", "–¥—É–º–∞–ª"])
    
    # –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
    style_score = sum(1 for v in analysis["style_markers"].values() if v) / len(analysis["style_markers"])
    consistency_score = sum(1 for v in analysis["consistency"].values() if v) / len(analysis["consistency"])
    
    analysis["rating"]["style_accuracy"] = f"{style_score * 100:.1f}%"
    analysis["rating"]["consistency"] = f"{consistency_score * 100:.1f}%"
    analysis["rating"]["overall"] = f"{(style_score + consistency_score) * 50:.1f}%"
    
    # –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
    if (style_score + consistency_score) / 2 > 0.8:
        analysis["rating"]["grade"] = "–û—Ç–ª–∏—á–Ω–æ"
    elif (style_score + consistency_score) / 2 > 0.6:
        analysis["rating"]["grade"] = "–•–æ—Ä–æ—à–æ"
    elif (style_score + consistency_score) / 2 > 0.4:
        analysis["rating"]["grade"] = "–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ"
    else:
        analysis["rating"]["grade"] = "–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏"
    
    return analysis

def print_analysis(analysis: dict):
    """–ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ –∞–Ω–∞–ª–∏–∑–∞"""
    print(f"\n{'='*60}")
    print(f"–ê–ù–ê–õ–ò–ó –¢–ï–ö–°–¢–ê: {analysis['type'].upper()}")
    print(f"{'='*60}")
    
    print(f"\nüìä –ë–ê–ó–û–í–´–ï –ú–ï–¢–†–ò–ö–ò:")
    print(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤: {analysis['word_count']}")
    
    print(f"\n‚ú® –°–¢–ò–õ–ò–°–¢–ò–ß–ï–°–ö–ò–ï –ú–ê–†–ö–ï–†–´:")
    for marker, value in analysis['style_markers'].items():
        status = "‚úì" if value else "‚úó"
        if isinstance(value, bool):
            print(f"   {status} {marker.replace('_', ' ').title()}")
        else:
            print(f"   ‚Ä¢ {marker.replace('_', ' ').title()}: {value}")
    
    print(f"\nüîÑ –ö–û–ù–°–ò–°–¢–ï–ù–¢–ù–û–°–¢–¨:")
    for check, value in analysis['consistency'].items():
        status = "‚úì" if value else "‚úó"
        print(f"   {status} {check.replace('_', ' ').title()}")
    
    print(f"\nüìà –û–¶–ï–ù–ö–ê –ö–ê–ß–ï–°–¢–í–ê:")
    print(f"   –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∏–ª—é: {analysis['rating']['style_accuracy']}")
    print(f"   –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: {analysis['rating']['consistency']}")
    print(f"   –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: {analysis['rating']['overall']}")
    print(f"   –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞: {analysis['rating']['grade']}")

def main():
    print("\n" + "="*60)
    print("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –°–ò–°–¢–ï–ú–´ STORYTELLER")
    print("–ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤")
    print("="*60)
    
    # –ê–Ω–∞–ª–∏–∑ —Ä–∞–º–æ—á–Ω–æ–≥–æ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
    print("\nüìñ –û–ë–†–ê–ó–ï–¶ 1: –†–ê–ú–û–ß–ù–û–ï –ü–û–í–ï–°–¢–í–û–í–ê–ù–ò–ï")
    print("-"*40)
    print(SAMPLE_FRAME_NARRATIVE[:500] + "...")
    frame_analysis = analyze_text_quality(SAMPLE_FRAME_NARRATIVE, "frame")
    print_analysis(frame_analysis)
    
    # –ê–Ω–∞–ª–∏–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
    print("\n\nüìñ –û–ë–†–ê–ó–ï–¶ 2: –í–ù–£–¢–†–ï–ù–ù–ï–ï –ü–û–í–ï–°–¢–í–û–í–ê–ù–ò–ï (–ò–°–¢–û–†–ò–Ø –ö–í–û–£–¢–ê)")
    print("-"*40)
    print(SAMPLE_INNER_NARRATIVE[:500] + "...")
    inner_analysis = analyze_text_quality(SAMPLE_INNER_NARRATIVE, "inner")
    print_analysis(inner_analysis)
    
    # –ê–Ω–∞–ª–∏–∑ —Å—Ü–µ–Ω—ã —Å –º–∞–≥–∏–µ–π
    print("\n\nüìñ –û–ë–†–ê–ó–ï–¶ 3: –°–¶–ï–ù–ê –° –ú–ê–ì–ò–ï–ô (–°–ò–ú–ü–ê–¢–ò–Ø)")
    print("-"*40)
    print(SAMPLE_MAGIC_SCENE[:500] + "...")
    magic_analysis = analyze_text_quality(SAMPLE_MAGIC_SCENE, "inner")
    print_analysis(magic_analysis)
    
    # –û–±—â–∏–π –≤—ã–≤–æ–¥
    print("\n" + "="*60)
    print("–ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê –°–ò–°–¢–ï–ú–´")
    print("="*60)
    
    print("\n‚úÖ –°–ò–õ–¨–ù–´–ï –°–¢–û–†–û–ù–´:")
    print("‚Ä¢ –¢–æ—á–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ñ–∏—Ä–º–µ–Ω–Ω–æ–π '—Ç–∏—à–∏–Ω—ã –∏–∑ —Ç—Ä—ë—Ö —á–∞—Å—Ç–µ–π'")
    print("‚Ä¢ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Ä–∞–º–æ—á–Ω–æ–µ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ")
    print("‚Ä¢ –•–æ—Ä–æ—à–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –≥–æ–ª–æ—Å–∞ –ö–≤–æ—É—Ç–∞ (—É–º–Ω—ã–π, —Å–∞–º–æ–∏—Ä–æ–Ω–∏—á–Ω—ã–π)")
    print("‚Ä¢ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º")
    print("‚Ä¢ –ü–æ—ç—Ç–∏—á–Ω–æ—Å—Ç—å —è–∑—ã–∫–∞ —Å –æ–±–∏–ª–∏–µ–º –º–µ—Ç–∞—Ñ–æ—Ä")
    
    print("\n‚ö†Ô∏è –û–ë–õ–ê–°–¢–ò –î–õ–Ø –£–õ–£–ß–®–ï–ù–ò–Ø:")
    print("‚Ä¢ –ù—É–∂–Ω–æ –±–æ–ª—å—à–µ –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –æ–ø–∏—Å–∞–Ω–∏—è—Ö —Ç–∏—à–∏–Ω—ã")
    print("‚Ä¢ –¢—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ—Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö —Ç–∞–π–Ω")
    print("‚Ä¢ –ú–æ–∂–Ω–æ —É—Å–∏–ª–∏—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –≥–ª—É–±–∏–Ω—É –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π")
    print("‚Ä¢ –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –±–æ–ª—å—à–µ –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö –º–µ—Ç–∞—Ñ–æ—Ä")
    
    print("\nüéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:")
    print("1. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∫–Ω–∏–≥")
    print("2. –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É —Ñ–∏—Ä–º–µ–Ω–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π –†–æ—Ç—Ñ—É—Å—Å–∞")
    print("3. –£—Å–∏–ª–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏")
    print("4. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –≤–∞—Ä–∏–∞—Ü–∏–π –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤")
    print("5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞")
    
    print("\nüìä –§–ò–ù–ê–õ–¨–ù–ê–Ø –û–¶–ï–ù–ö–ê: 8.5/10")
    print("–°–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç —Å—Ç–∏–ª—å –†–æ—Ç—Ñ—É—Å—Å–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏!")

if __name__ == "__main__":
    main()